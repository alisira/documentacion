<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Capítulo&nbsp;5.&nbsp;Implementando Persistencia en Base
de Datos</title>
<link rel="stylesheet" href="Cap%C3%ADtulo%C2%A05.%C2%A0Implementando%20Persistencia%20en%20Base%20de%20Datos%20Archivos/html.css" type="text/css">
<link rel="home" href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/index.html" title="Desarrollando una aplicación Spring Framework MVC v4 + JPA paso a paso">
<link rel="up" href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/index.html" title="Desarrollando una aplicación Spring Framework MVC v4 + JPA paso a paso">
<link rel="previous" href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/part4.html" title="Capítulo&nbsp;4.&nbsp;Desarrollando la Interface Web">
<link rel="next" href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/part6.html" title="Capítulo&nbsp;6.&nbsp;Integrando la Aplicación Web con la capa de Persistencia">
</head>
<body alink="#0000ff" link="#0000ff" text="black" vlink="#840084" bgcolor="white">
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="border: 1px solid black; background-color: white; height: 73px;"><a style="border: medium none;" href="http://www.springframework.org/" title="The Spring Framework"><img style="border: medium none;" src="Cap%C3%ADtulo%C2%A05.%C2%A0Implementando%20Persistencia%20en%20Base%20de%20Datos%20Archivos/xdev-spring_logo.jpg"></a><a style="border: medium none;" href="http://www.springsource.com/" title="SpringSource"><img style="border: medium none; position: absolute; padding-top: 5px; right: 42px;" src="Cap%C3%ADtulo%C2%A05.%C2%A0Implementando%20Persistencia%20en%20Base%20de%20Datos%20Archivos/springsource-banner-rhs.png"></a></div>
<div class="chapter" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="part5"></a>Capítulo&nbsp;5.&nbsp;Implementando
Persistencia en Base de Datos</h2>
</div>
</div>
<div></div>
</div>

<p>Esta es la Parte 5 del tutorial paso a paso sobre sobre cómo
desarrollar una aplicación web desde cero usando Spring Framework. En la
<a href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/part1.html" title="Capítulo&nbsp;1.&nbsp;Aplicación Base y Configuración del Entorno">Parte 1</a> hemos configurado el entorno y puesto en marcha una aplicación básica. En la <a href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/part2.html" title="Capítulo&nbsp;2.&nbsp;Desarrollando y Configurando la Vista y el Controlador">Parte 2</a> hemos mejorado la aplicación que habíamos construido hasta entonces. En la <a href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/part3.html" title="Capítulo&nbsp;3.&nbsp;Desarrollando la Lógica de Negocio">Parte 3</a> hemos añadido toda la lógica de negocio y los tests unitarios, y en la <a href="http://www.uv.es/grimo/teaching/SpringMVCv4PasoAPaso/part4.html" title="Capítulo&nbsp;4.&nbsp;Desarrollando la Interface Web">Parte 4</a> hemos desarrollado la interface web. Ahora es el momento de introducir
persistencia en base de datos. En las partes anteriores hemos visto cómo
cargar algunos objetos de negocio definiendo beans en un archivo de
configuración. Es obvio que esta solución nunca va a funcionar en el
mundo real – cada vez que reiniciemos el servidor obtendremos de nuevo
los precios originales. Necesitamos añadir código para persistir esos
cambios en una base de datos.</p>

<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both;"><a name="step5.1"></a>5.1.&nbsp;Creación y rellenado de la base de datos</h2>
</div>
</div>
<div></div>
</div>

<p>Antes de que podamos comenzar a desarrollar el código de
persistencia, necesitamos una base de datos. En lugar de confiar en una 
base de datos integrada con la propia aplicación, vamos a utilizar una 
base de datos separada. Hemos planeado usar <a href="http://www.mysql.com/"><tt class="literal">MySQL</tt></a>,
 una buena base de datos de código libre. Sin embargo, los pasos que se 
muestran a continuación serán similares para otras bases de datos (p. 
ej. <a href="http://www.mysql.com/"><tt class="literal">PostgreSQL</tt></a>, <a href="http://www.mysql.com/"><tt class="literal">HSQL</tt></a>...). Desde el enlace anterior, se puede descargar <tt class="literal">MySQL</tt>
 para diferentes sistemas operativos. Una vez instalada, cada 
distribución proporciona sus correspondientes scripts de inicio para 
arrancar la base de datos.</p>

<p>Primero, creamos el fichero <tt class="filename">'springapp.sql'</tt> (en el directorio <tt class="filename">'db'</tt>) con las sentencias SQL necesarias para la creación de la base de datos <tt class="literal">springapp</tt>. Este fichero creará también la tabla <tt class="literal">products</tt>, que alojará los productos de nuestra aplicación. Además, establecerá los permisos para el usuario <tt class="literal">springappuser</tt>.</p>

<p><tt class="filename">'springapp/db/springapp.sql'</tt>:</p>
<pre class="programlisting">CREATE DATABASE springapp;

GRANT ALL ON springapp.* TO springappuser@'%' IDENTIFIED BY 'pspringappuser';
GRANT ALL ON springapp.* TO springappuser@localhost IDENTIFIED BY 'pspringappuser';

USE springapp;

CREATE TABLE products (
  id INTEGER PRIMARY KEY,
  description varchar(255),
  price decimal(15,2)
);
CREATE INDEX products_description ON products(description);</pre>

<p>A continuación, necesitamos añadir nuestros datos de prueba. Para ello, creamos el
archivo <tt class="filename">'load_data.sql'</tt> en el directorio <tt class="filename">'db'</tt> con el siguiente contenido:</p>

<p><tt class="filename">'springapp/db/load_data.sql'</tt>:</p>
<pre class="programlisting">INSERT INTO products (id, description, price) values(1, 'Lamp', 5.78);
INSERT INTO products (id, description, price) values(2, 'Table', 75.29);
INSERT INTO products (id, description, price) values(3, 'Chair', 22.81);</pre>

<p>Por último, ejecutamos las siguientes instrucciones sobre la línea de comandos para crear y rellenar la base de datos:</p>

<pre class="programlisting">linux:springapp/db# mysql -u root -p
Enter password:
...
mysql&gt; source springapp.sql
mysql&gt; source load_data.sql</pre>

<p>Para poder acceder desde nuestra aplicación a la base de datos <tt class="literal">MySQL</tt> mediante JPA, debemos incluir las siguientes dependencias en el fichero <tt class="filename">'pom.xml'</tt>:</p>

<table border="1">
  <thead bgcolor="lightGray">
    <tr>
      <th>Group Id</th>
      <th>Artifact Id</th>
      <th>Version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><tt class="literal">mysql</tt></td>
      <td><tt class="literal">mysql-connector-java</tt></td>
      <td><tt class="literal">5.1.30</tt></td>
    </tr>
    <tr>
      <td><tt class="literal">org.hibernate.java-persistence</tt></td>
      <td><tt class="literal">jpa-api</tt></td>
      <td><tt class="literal">2.0-cr-1</tt></td>
    </tr>
    <tr>
      <td><tt class="literal">org.hibernate</tt></td>
      <td><tt class="literal">hibernate-entitymanager</tt></td>
      <td><tt class="literal">4.2.0.Final</tt></td>
    </tr>
    <tr>
      <td><tt class="literal">org.springframework</tt></td>
      <td><tt class="literal">spring-orm</tt></td>
      <td><tt class="literal">${org.springframework.version}</tt></td>
    </tr>
  </tbody>
</table>

</div>
<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both;"><a name="step5.2"></a>5.2.&nbsp;Crear una implementación para JPA de un Objeto de </h2></div></div></div></div></div></body></html>